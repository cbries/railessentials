!function(e){e.fn.speedCurve=function(t){var o=e.extend({speedMode:"dcc28",width:750,height:200,speedTimeMaxDefault:5,speedStepMaxDefault:null,preloadData:[],onChanged:null},t),n={dcc14:{speedsteps:14,extraWidthForSteps:2,noobyWidth:4,noobyHeight:4,deltaShow:1},dcc28:{speedsteps:28,extraWidthForSteps:2,noobyWidth:4,noobyHeight:4,deltaShow:2},dcc128:{speedsteps:128,extraWidthForSteps:2,noobyWidth:4,noobyHeight:4,deltaShow:4},mm14:{speedsteps:14,extraWidthForSteps:2,noobyWidth:4,noobyHeight:4,deltaShow:1},mm27:{speedsteps:27,extraWidthForSteps:0,noobyWidth:4,noobyHeight:4,deltaShow:2},mm128:{speedsteps:128,extraWidthForSteps:2,noobyWidth:4,noobyHeight:4,deltaShow:5}}[o.speedMode],s=this,d=!1;function i(){const t=s,d=t.find(".speedCurveRoot"),i=t.find("select#cmbSpeedMax"),p=t.find("select#cmbSpeedTimeMax"),a=parseInt(i.val()),l=e(".nooby_"+a);let c=parseInt(l.css("top").replace("px",""));c+=n.noobyHeight/2,__lineSpeed.css({top:c});const h=parseInt(p.val());let u=parseInt(l.css("left").replace("px",""));u+=n.noobyWidth/2,__lineTime.css({left:u});const f=d.get(0).getBoundingClientRect(),g=f.top+f.height,b=__chkLabelShow.is(":checked"),m=h/a;let x=0;const S=e(".nooby");for(let t=0;t<S.length;++t){const s=e(S[t]),d=s.find(".noobyTimeLbl"),i=s.find(".noobySpeedLbl");let p=x.toString();p=p.substr(0,3),d.html(p+"s");const l=(g-s.get(0).getBoundingClientRect().top)/o.height,c=parseInt(l*n.speedsteps);i.html(c),d.removeClass("timeHighlight"),i.removeClass("speedHighlight"),t>a?(d.hide(),i.hide(),s.data("speed",0),s.data("timeStep",0)):t===a?(d.addClass("timeHighlight"),i.addClass("speedHighlight"),i.html(a),d.show(),i.show()):(1==b?d.show():d.hide(),1==b?i.show():i.hide(),s.data("speed",c),s.data("timeStep",x)),x+=m}null!=o.onChanged&&o.onChanged({data:r()})}function p(t){const s=e(".nooby"),d=n.speedsteps,p=n.deltaShow,a=[0,2,5.763,9.573,13.48,17.536,21.794,26.306,31.127,36.309,41.909,47.98,54.578,61.759,69.578,78.091,87.353,97.423,108.356,120.208,133.037,146.9,161.854,177.956,195.264,213.836,233.728,255];let c=a;0===t?c=a:1===t&&(c=[0,2,4.591,7.786,11.562,15.905,20.809,26.266,32.272,38.822,45.914,53.543,61.706,70.402,79.628,89.382,99.662,110.465,121.792,133.639,146.005,158.889,172.29,186.206,200.636,215.579,231.034,247]),void 0!==o.preloadData&&null!=o.preloadData&&o.preloadData.length>0&&(c=o.preloadData);const h=c.length;for(let t=0,n=0;t<h-1;++t,n+=p){const i=c[t],a=c[t+1];let r=n+p;t===h-2&&(r=d);const u=(a-i)/(r-n);for(let t=n,d=0;t<r;++t,++d){const n=i+u*d;l(e(s[t]),o.height/255*n)}}i()}function a(){const e=s.get(0).getBoundingClientRect(),t=e.top,o=e.left;return{top:t+e.height-n.noobyHeight/2,left:o-(n.noobyWidth/2-1)}}function l(e,t){t=a().top-t,e.css({top:t+"px"})}function c(t=!0){const o=a(),n=e(".nooby");for(let s=0;s<n.length;++s){const d=e(n[s]),i=(d.data("index"),d.data("xsteps")),p=o.left+parseInt(s*i);1==t?d.css({top:o.top+"px",left:p+"px"}):d.css({left:p+"px"})}}function h(t){const d=o.width/n.speedsteps,p=function(e,t,o){if(e<0)return-1;if(e>t)return-1;let n=0;for(let s=0;s<t;s+=o){const t=s,d=t+o;if(e>=t&&e<d)return n;++n}return-1}(t.x,o.width,d);if(p<0)return;const a=e(".nooby_"+p);if(void 0===a||null==a||0===a.length)return;const l=s,c=l.get(0).getBoundingClientRect().top+l.get(0).getBoundingClientRect().height-n.noobyHeight;t.topPage>c||(a.css({top:t.topPage+"px"}),i())}function r(){const t=s,o=t.find("select#cmbSpeedMax"),n=t.find("select#cmbSpeedTimeMax"),d=parseInt(o.val()),i=parseInt(n.val()),p=e(".nooby");let a=[];for(let t=0;t<p.length;++t){const o=e(p[t]),n=o.data("speed"),s=o.data("timeStep");if(0===s)continue;const d={speed:n,timeStep:s};a.push(d)}return{maxSpeed:d,maxTime:i,steps:a}}null==o.speedStepMaxDefault&&(o.speedStepMaxDefault=parseInt(n.speedsteps/2)),document.body.onmousedown=function(){d=!0},document.body.onmouseup=function(){d=!1},window.addEventListener("resize",function(){c(!1),i()}),s.append('<div class="speedCurveRoot"></div><div class="speedCurveControls">Preloads:<button id="cmdSpeedLinear">Linear</button><button id="cmdSpeedExponentialEsu">Exponential ESU</button><button id="cmdSpeedExponentialLenz">Exponential Lenz</button><input type="checkbox" id="chkLabelShow" name="chkLabelShow"><label for="chkLabelShow"> Show Labels</label><div style="padding-top: 10px;">Speedstep (max): <select id="cmbSpeedMax"></select></div><div style="padding-top: 10px;">Time (max): <select id="cmbSpeedTimeMax"></select></div></div>'),__chkLabelShow=s.find("#chkLabelShow"),__speedCurveRoot=s.find(".speedCurveRoot"),function(){const t=s;t.css({width:o.width+"px",height:o.height+"px"}),__lineSpeed=e("<div>").css({width:o.width+"px"}).addClass("speedCurveLineSpeed"),__lineSpeed.appendTo(__speedCurveRoot),__lineTime=e("<div>").css({height:o.height+"px"}).addClass("speedCurveLineTime"),__lineTime.appendTo(__speedCurveRoot);const a=o.width/n.speedsteps,r=(o.width+a-n.noobyWidth/2+n.extraWidthForSteps)/n.speedsteps;let u=e();for(let t=0;t<n.speedsteps;++t){const o=e("<div>").css({width:n.noobyWidth+"px",height:n.noobyHeight+"px"}).data("index",t).data("xsteps",r).addClass("nooby_"+t).addClass("nooby"),s=e("<div>").addClass("noobySpeedLbl").html("");s.appendTo(o);let d="";const i=e("<div>").addClass("noobyTimeLbl").html(d);i.appendTo(o),u=u.add(o)}t.append(u),c();const f=t.find("select#cmbSpeedMax");for(let t=0;t<n.speedsteps;++t){const o=e("<option>",{value:t}).html(t);o.appendTo(f)}f.change(function(t){const o=e(this).val();!function(t){const o=e(".nooby"),n=parseInt(t);for(let t=0;t<o.length;++t){const s=e(o[t]);s.removeClass("noobyMax"),t===n&&s.addClass("noobyMax")}}(o),i()}),f.val(o.speedStepMaxDefault);const g=t.find("select#cmbSpeedTimeMax");for(let t=0;t<n.speedsteps;++t)if(t===o.speedTimeMaxDefault){const o=e("<option>",{value:t,selected:""}).html(t+"s");o.appendTo(g)}else{const o=e("<option>",{value:t}).html(t+"s");o.appendTo(g)}g.change(function(e){i()}),t.mouseleave(function(e){d=!1}),t.mousemove(function(e){e.preventDefault();const t=function(e,t){const o=t.pageX,n=t.pageY,s=e.getBoundingClientRect().top,d=e.getBoundingClientRect().left;return{x:o-d,y:n-s,topPage:n,leftPage:o}}(this,e);__recentMouseMoveCoord=t,!1!==d&&h(t)}),t.click(function(e){h(__recentMouseMoveCoord)});const b=t.find("#cmdSpeedLinear"),m=t.find("#cmdSpeedExponentialEsu"),x=t.find("#cmdSpeedExponentialLenz");b.click(function(t){!function(){const t=e(".nooby"),s=n.speedsteps,d=o.height/s;for(let o=0;o<s;++o){const n=e(t[o]),s=o*d;l(n,s)}i()}()}),m.click(function(e){p(0)}),x.click(function(e){p(1)}),__chkLabelShow.click(function(){const t=e(".noobySpeedLbl");for(let o=0;o<t.length;++o){const n=e(t[o]);!0===this.checked?n.show():n.hide()}const o=e(".noobyTimeLbl");for(let t=0;t<o.length;++t){const n=e(o[t]);!0===this.checked?n.show():n.hide()}}),i(),0==o.preloadData.length&&p(0)}()}}(jQuery);